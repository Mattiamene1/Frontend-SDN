<html lang="it">
    
    <head>
        <meta charset="UTF-8">
        <title>Visualizzatore topologie di Rete</title>
        <!--Stili vari-->
        <link rel="stylesheet" href="Next/style.css">
        <link rel="stylesheet" href="addingstyle.css">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- Vue 3 e i18n -->
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://unpkg.com/vue-i18n@9/dist/vue-i18n.global.js"></script>
        <script src="https://unpkg.com/vue@3"></script>
        
        <!--Script di ops-->
        <script src="index.js"></script>
        <script src="Next/next.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js" 
            integrity="sha512-emSwuKiMyYedRwflbZB2ghzX8Cw8fmNVgZ6yQNNXXagFzFOaQmbvQ1vmDkddHjm5AITcBIZfC7k4ShQSjgPAmQ==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer">
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    </head>

    <body>
        <div id="ContenitoreGrosso" class="container1">

            <div class="language-switch">
                <button class="btn btn-info" @click="switchLanguage()">
                    {{ $i18n.locale === 'it' ? 'Switch to English' : 'Cambia in Italiano' }}
                </button>
            </div>

            <div class="switch-container">
                <label class="ui-switch">
                    <input type="checkbox"> 
                    <div class="slider">
                        <div class="circle"></div>
                    </div>
                </label>
            </div>
            
            <div id="app" class="container">
                <div id="firstraw" class="container2">
                    <!-- Pulsanti per gestire l'aggiornamento automatico della vista -->
                    <button class="btn btn-primary" @click="toggleAutoUpdate()">
                        {{ $t('text.autoUpdateButtonText') }}
                    </button>
                    &emsp;
                    <!-- Pulsanti per cambiare il layout della topologia -->
                    <button class="btn btn-secondary" @click="changeLayout('vertical')" v-if="!autoUpdate">
                        {{ $t('text.layoutVertical') }}
                    </button>
                    &emsp;
                    <button class="btn btn-secondary" @click="changeLayout('horizontal')" v-if="!autoUpdate">
                        {{ $t('text.layoutHorizontal') }}
                    </button>
                </div>
                &emsp;
                <!-- Dettagli dello switch selezionato -->
                <div class="row" v-if="switchDetails">
                    <div class="mt-2 col">
                        <h2>{{ $t('text.switchDetailsTitle') }}</h2>
                        <p>DPID: {{ switchData.dpid }}</p>
                        <a class="btn btn-danger" href="#" @click="hideSwitchDetails()">{{ $t('text.closeSwitchDetailsButton') }}</a>
                        <!-- Tabella delle porte dello switch -->
                        <h2>{{ $t('text.switchPortsTitle') }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <th>{{ $t('text.portNumber') }}</th>
                                <th>{{ $t('text.name') }}</th>
                                <th>{{ $t('text.macAddress') }}</th>
                            </thead>
                            <tbody>
                                <!-- Ciclo per ogni porta dello switch -->
                                <tr v-for="port in switchData.ports">
                                    <td>{{ port.port_no }}</td>
                                    <td>{{ port.name }}</td>
                                    <td>{{ port.hw_addr }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Tabella delle regole del flusso per lo switch -->
                        <h2 class="mt-2">{{ $t('text.flowTableTitle') }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>{{ $t('text.tableID') }}</th>
                                    <th>{{ $t('text.priority') }}</th>
                                    <th>{{ $t('text.actions') }}</th>
                                    <th>{{ $t('text.match') }}</th>
                                    <th>
                                        {{ $t('text.timeout') }}<br />
                                        <span class="badge text-bg-primary">{{ $t('text.idle') }}</span>&nbsp;
                                        <span class="badge text-bg-success">{{ $t('text.hard') }}</span>
                                    </th>
                                    <th>{{ $t('text.duration') }}</th>
                                    <th>{{ $t('text.packetCount') }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Ciclo per ogni regola del flusso -->
                                <tr v-for="flow in flowTable">
                                    <td>{{ flow.table_id }}</td>
                                    <td>{{ flow.priority }}</td>
                                    <td>{{ flow.actions.join(', ') }}</td>
                                    <td>
                                        <!-- Ciclo per ogni corrispondenza nella regola del flusso -->
                                        <span v-for="(rule, key) in flow.match">
                                            <b>{{ key }}</b>: {{ rule }} |
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge text-bg-primary">{{ flow.idle_timeout }}</span>&nbsp;
                                        <span class="badge text-bg-success">{{ flow.hard_timeout }}</span>
                                    </td>
                                    <td>{{ flow.duration_sec }}</td>
                                    <td>{{ flow.packet_count }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Dettagli dell'host selezionato -->
                    <div class="mt-2 col" v-if="hostDetails">
                        <h2>{{ $t('text.timeout') }}</h2>
                        <p>
                            MAC: {{ host.mac }}<br>
                            <!-- Controlla e mostra gli indirizzi IPv4 e IPv6 dell'host se presenti -->
                            <template v-if="host.ipv4.length">IPv4: {{ host.ipv4.join(', ') }}<br></template>
                            <template v-if="host.ipv6.length">IPv6: {{ host.ipv6.join(', ') }}</template>
                        </p>
                        <a class="btn btn-danger" href="#" @click="hideHostDetails()">{{ $t('text.closeHostDetailsButton') }}</a>
                        <!-- Tabella per mostrare la porta dell'host connessa -->
                        <h2>{{ $t('text.connectedHostPortTitle') }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <th>{{ $t('text.portNumber') }}</th>
                                <th>{{ $t('text.name') }}</th>
                                <th>{{ $t('text.macAddress') }}</th>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ host.port.port_no }}</td>
                                    <td>{{ host.port.name }}</td>
                                    <td>{{ host.port.hw_addr }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Contenitore per la topologia -->
                <div id="topology-container"></div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                fetch('./translations.json')
                    .then(response => response.json())
                    .then(translations => {
                        const i18n = VueI18n.createI18n({
                            locale: 'it', // default locale
                            fallbackLocale: 'en',
                            messages: translations
                        });

                        const app = Vue.createApp({
                            data() {
                                return {
                                    autoUpdate: false,
                                    switchDetails: null,
                                    hostDetails: null,
                                };
                            },
                            methods: {
                                toggleAutoUpdate() {
                                    this.autoUpdate = !this.autoUpdate;
                                },
                                changeLayout(layout) {
                                    console.log("Layout changed to: " + layout);
                                },
                                hideSwitchDetails() {
                                    this.switchDetails = null;
                                },
                                hideHostDetails() {
                                    this.hostDetails = null;
                                },
                                switchLanguage() {
                                    this.$i18n.locale = this.$i18n.locale === 'it' ? 'en' : 'it';
                                }
                            }
                        });

                        app.use(i18n);
                        app.mount('#app');
                    });
            });
        </script>

    </body>

</html>
