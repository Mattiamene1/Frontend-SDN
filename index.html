<html lang="it">
    
    <head>
        <meta charset="UTF-8">
        <title>Visualizzatore topologie di Rete</title>
        <!--Stili vari-->
        <link rel="stylesheet" href="Next/style.css">
        <link rel="stylesheet" href="addingstyle.css">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">


        <!-- Vue 3 e i18n -->
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://unpkg.com/vue-i18n@9/dist/vue-i18n.global.js"></script>
        <script src="https://unpkg.com/vue@3"></script>
        
        <!--Script di ops-->
        <script src="index.js"></script>
        <script src="Next/next.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js" 
            integrity="sha512-emSwuKiMyYedRwflbZB2ghzX8Cw8fmNVgZ6yQNNXXagFzFOaQmbvQ1vmDkddHjm5AITcBIZfC7k4ShQSjgPAmQ==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer">
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            function changeLanguage(lang) {
                loadJSON(lang);
            }
        
            function loadJSON(lang = 'it') {
                fetch('translation.json')
                    .then(response => response.json())
                    .then(data => {
                        const texts = data[lang].text;

                        document.getElementById('title').textContent = texts.title;
                        document.getElementById('autoUpdateButtonText').textContent = texts.autoUpdateButtonText;
                        document.getElementById('layoutVertical').textContent = texts.layoutVertical;
                        document.getElementById('layoutHorizontal').textContent = texts.layoutHorizontal;
                        document.getElementById('switchDetailsTitle').textContent = texts.switchDetailsTitle.replace('{{switchId}}', switchId);
                        document.getElementById('closeSwitchDetailsButton').textContent = texts.closeSwitchDetailsButton;
                        document.getElementById('switchPortsTitle').textContent = texts.switchPortsTitle.replace('{{switchId}}', switchId);
                        document.getElementById('portNumber').textContent = texts.portNumber;
                        document.getElementById('name').textContent = texts.name;
                        document.getElementById('macAddress').textContent = texts.macAddress;
                        document.getElementById('flowTableTitle').textContent = texts.flowTableTitle.replace('{{switchId}}', switchId);
                        document.getElementById('tableID').textContent = texts.tableID;
                        document.getElementById('priority').textContent = texts.priority;
                        document.getElementById('actions').textContent = texts.actions;
                        document.getElementById('match').textContent = texts.match;
                        document.getElementById('timeout').textContent = texts.timeout;
                        document.getElementById('idle').textContent = texts.idle;
                        document.getElementById('duration').textContent = texts.duration;
                        document.getElementById('packetCount').textContent = texts.packetCount;
                        document.getElementById('hostDetailsTitle').textContent = texts.hostDetailsTitle.replace('{{switchId}}', switchId);
                        document.getElementById('closeHostDetailsButton').textContent = texts.closeHostDetailsButton;
                        document.getElementById('connectedHostPortTitle').textContent = texts.connectedHostPortTitle;
                    
                })
                .catch(error => console.error('Errore nel caricamento del file JSON:', error));
            }
        
            // Chiamata alla funzione al caricamento della pagina
            window.onload = () => loadJSON('it');
        </script>

    </head>

    <body>
        

        <div id="ContenitoreGrosso" class="container1">
            
            <input type="checkbox" id="toggle" title="Toggle">
            
            <div class="language-switch">
                <select id="languageSelector" onchange="changeLanguage(this.value)" title="Select Language">
                    <option value="it">Italiano</option>
                    <option value="en">English</option>
                </select>
            </div>


            <div id="app" class="container">
                <div id="firstraw" class="container2">
                    <!-- Pulsanti per gestire l'aggiornamento automatico della vista -->
                    <button class="btn btn-primary" @click="toggleAutoUpdate()">
                        {{ text.autoUpdateButtonText }}
                    </button>
                    &emsp;
                    <!-- Pulsanti per cambiare il layout della topologia -->
                    <button class="btn btn-secondary" @click="changeLayout('vertical')" v-if="!autoUpdate">
                        {{ text.layoutVertical }}
                    </button>
                    &emsp;
                    <button class="btn btn-secondary" @click="changeLayout('horizontal')" v-if="!autoUpdate">
                        {{ text.layoutHorizontal }}
                    </button>
                </div>
                &emsp;
                <!-- Dettagli dello switch selezionato -->
                <div class="column" v-if="switchDetails">
                    <div class="mt-2 col">
                        <h2>{{ text.switchDetailsTitle }}</h2>
                        <p>DPID: {{ switchData.dpid }}</p>
                        <a class="btn btn-danger" href="#" @click="hideSwitchDetails()">{{ text.closeSwitchDetailsButton }}</a>
                        <!-- Tabella delle porte dello switch -->
                        <h2>{{ text.switchPortsTitle }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <th>{{ text.portNumber }}</th>
                                <th>{{ text.name }}</th>
                                <th>{{ text.macAddress }}</th>
                            </thead>
                            <tbody>
                                <!-- Ciclo per ogni porta dello switch -->
                                <tr v-for="port in switchData.ports">
                                    <td>{{ port.port_no }}</td>
                                    <td>{{ port.name }}</td>
                                    <td>{{ port.hw_addr }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- Tabella delle regole del flusso per lo switch -->
                        <h2 class="mt-2">{{ text.flowTableTitle }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>{{ text.tableID }}</th>
                                    <th>{{ text.priority }}</th>
                                    <th>{{ text.actions }}</th>
                                    <th>{{ text.match }}</th>
                                    <th>
                                        {{ text.timeout }}<br />
                                        <span class="badge text-bg-primary">{{ text.idle }}</span>&nbsp;
                                        <span class="badge text-bg-success">{{ text.hard }}</span>
                                    </th>
                                    <th>{{ text.duration }}</th>
                                    <th>{{ text.packetCount }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Ciclo per ogni regola del flusso -->
                                <tr v-for="flow in flowTable">
                                    <td>{{ flow.table_id }}</td>
                                    <td>{{ flow.priority }}</td>
                                    <td>{{ flow.actions.join(', ') }}</td>
                                    <td>
                                        <!-- Ciclo per ogni corrispondenza nella regola del flusso -->
                                        <span v-for="(rule, key) in flow.match">
                                            <b>{{ key }}</b>: {{ rule }} |
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge text-bg-primary">{{ flow.idle_timeout }}</span>&nbsp;
                                        <span class="badge text-bg-success">{{ flow.hard_timeout }}</span>
                                    </td>
                                    <td>{{ flow.duration_sec }}</td>
                                    <td>{{ flow.packet_count }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Dettagli dell'host selezionato -->
                    <div class="mt-2 col" v-if="hostDetails">
                        <h2>{{ text.timeout }}</h2>
                        <p>
                            MAC: {{ host.mac }}<br>
                            <!-- Controlla e mostra gli indirizzi IPv4 e IPv6 dell'host se presenti -->
                            <template v-if="host.ipv4.length">IPv4: {{ host.ipv4.join(', ') }}<br></template>
                            <template v-if="host.ipv6.length">IPv6: {{ host.ipv6.join(', ') }}</template>
                        </p>
                        <a class="btn btn-danger" href="#" @click="hideHostDetails()">{{ text.closeHostDetailsButton }}</a>
                        <!-- Tabella per mostrare la porta dell'host connessa -->
                        <h2>{{ text.connectedHostPortTitle }}</h2>
                        <table class="mt-2 table table-bordered table-sm">
                            <thead>
                                <th>{{ text.portNumber }}</th>
                                <th>{{ text.name }}</th>
                                <th>{{ text.macAddress }}</th>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ host.port.port_no }}</td>
                                    <td>{{ host.port.name }}</td>
                                    <td>{{ host.port.hw_addr }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Contenitore per la topologia -->
                <div id="topology-container"></div>
            </div>
        </div>

    </body>

</html>
